# Admin API Request/Response Examples

**Date**: December 8, 2025
**Generated By**: `probe_api.sh` (Automated Analysis)
**Version**: v0.7.2 (Dev)

This document contains actual request and response payloads captured from the running server. It serves as the "Ground Truth" for the current API implementation.

## 1. Authentication

### Login
**POST** `/api/login`
```json
{
  "username": "admin",
  "password": "password"
}
```
**Response (200 OK)**
```json
{
  "success": true,
  "message": "Login successful"
}
```

### Auth Status
**GET** `/api/auth/status`
**Response (200 OK)**
```json
{
  "authenticated": true,
  "username": "admin",
  "expiresAt": "2025-12-09T..."
}
```

### Current User
**GET** `/api/user/me`
**Response (200 OK)**
```json
{
  "username": "admin",
  "version": "dev"
}
```

### Logout
**POST** `/api/logout`
**Response (200 OK)**
```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

## 2. System & Observability

### Health
**GET** `/api/system/health`
**Response (200 OK)**
```json
{
  "status": "healthy",
  "uptime_seconds": 1.25,
  "version": "dev",
  "mode": "development",
  "memory": {
    "used_mb": 2.14,
    "limit_mb": 15945.19,
    "vfs_cache_mb": 0
  },
  "database": {
    "path": "./probe_data.db",
    "open_connections": 1,
    "in_use": 0
  },
  "runtime": {
    "queued_events": 0,
    "goroutines": 9
  }
}
```
*Note: Returns raw object (no `data` wrapper in some versions, but probe shows `data` wrapper? Wait, let me check the dump again. Ah, `handlers/system.go` uses `api.JSON` which adds `data` wrapper. The dump shows `{"data":{...}}`. Correcting above.)*

**Correction based on Dump:**
```json
{
  "data": {
    "status": "healthy",
    "uptime_seconds": 1.25,
    ...
  }
}
```

### Limits
**GET** `/api/system/limits`
**Response (200 OK)**
```json
{
  "data": {
    "TotalRAM": 16719749120,
    "AvailableRAM": 16719749120,
    "CPUCount": 6,
    "MaxVFSBytes": 4179937280,
    "MaxUploadBytes": 104857600
  }
}
```

### Config
**GET** `/api/system/config` (or `/api/config`)
**Response (200 OK)**
```json
{
  "data": {
    "domain": "localhost",
    "env": "development",
    "https": false,
    "ntfy": true,
    "version": "dev"
  }
}
```

## 3. Dashboard Analytics

### Stats
**GET** `/api/stats`
**Response (200 OK)** - *Raw JSON Object*
```json
{
  "total_events_today": 0,
  "total_events_week": 100,
  "total_events_month": 100,
  "total_events_all_time": 100,
  "events_by_source_type": {
    "pixel": 32,
    "redirect": 36,
    "web": 32
  },
  "top_domains": [
    { "domain": "example.com", "count": 25 },
    ...
  ],
  "top_tags": [ ... ],
  "events_timeline": [ ... ],
  "total_unique_domains": 5,
  "total_redirect_clicks": 378
}
```

### Events
**GET** `/api/events`
**Response (200 OK)** - *Raw JSON Array*
```json
[
  {
    "id": 63,
    "domain": "example.com",
    "event_type": "pageview",
    "source_type": "web",
    "path": "/blog",
    "ip_address": "192.168.1.205",
    "created_at": "2025-12-08T22:09:41+04:00",
    ...
  },
  ...
]
```

### Domains
**GET** `/api/domains`
**Response (200 OK)** - *Raw JSON Array*
```json
[
  { "domain": "example.com", "count": 25 },
  ...
]
```

### Tags
**GET** `/api/tags`
**Response (200 OK)** - *Raw JSON Array*
```json
[
  { "tag": "twitter", "count": 7 },
  ...
]
```

## 4. Redirects

### List Redirects
**GET** `/api/redirects`
**Response (200 OK)** - *Raw JSON Array*
```json
[
  {
    "id": 10,
    "slug": "demo",
    "destination": "https://demo.example.com",
    "click_count": 84,
    "tags": ["campaign-123"],
    "created_at": "2025-12-08T18:09:41Z"
  },
  ...
]
```

### Create Redirect
**POST** `/api/redirects`
**Request**
```json
{
  "slug": "test-redirect",
  "destination": "https://example.com",
  "tags": ["promo"]
}
```
**Response (201 Created)** - *Raw JSON Object*
```json
{
  "id": 11,
  "slug": "test-redirect",
  "destination": "https://example.com",
  "tags": ["promo"],
  "click_count": 0
}
```

### Delete Redirect
**DELETE** `/api/redirects/{id}`
**Response (200 OK)**
```json
{
  "data": {
    "message": "Redirect deleted"
  }
}
```
*Note: This uses the standard `data` wrapper.*

## 5. Webhooks

### List Webhooks
**GET** `/api/webhooks`
**Response (200 OK)** - *Raw JSON Array*
```json
[
  {
    "id": 1,
    "name": "GitHub Deployments",
    "endpoint": "github-deploy",
    "has_secret": false,
    "is_active": true,
    "created_at": "2025-12-08T18:09:41Z"
  },
  ...
]
```

### Create Webhook
**POST** `/api/webhooks`
**Request**
```json
{
  "name": "Test Hook",
  "endpoint": "test-hook",
  "secret": "supersecret"
}
```
**Response (201 Created)**
```json
{
  "id": 6,
  "name": "Test Hook",
  "endpoint": "test-hook",
  "has_secret": true,
  "is_active": true
}
```

### Update Webhook
**PUT** `/api/webhooks/{id}`
**Request**
```json
{ "name": "Updated Hook" }
```
**Response (200 OK)**
```json
{
  "data": {
    "id": 1,
    "name": "Updated Hook",
    "endpoint": "github-deploy",
    "has_secret": false,
    "is_active": true
  }
}
```
*Note: Uses `data` wrapper.*

### Delete Webhook
**DELETE** `/api/webhooks/{id}`
**Response (200 OK)**
```json
{
  "data": {
    "message": "Webhook deleted"
  }
}
```

## 6. Access Control (API Keys)

### List Keys
**GET** `/api/keys`
**Response (200 OK)**
```json
{
  "success": true,
  "keys": null
}
```
*Note: Returns `keys` array (or null if empty) and `success` boolean. No `data` wrapper.*

### Create Key
**POST** `/api/keys`
**Request**
```json
{ "name": "Deploy Key", "scopes": "deploy" }
```
**Response (200 OK)**
```json
{
  "success": true,
  "token": "...",
  "message": "API key created..."
}
```

## 7. Hosting & Deployment

### List Sites
**GET** `/api/sites`
**Response (200 OK)**
```json
{
  "data": [
    {
      "Name": "admin",
      "Path": "vfs://admin",
      "FileCount": 13,
      "SizeBytes": 55442,
      "ModTime": "2025-12-08 18:09:41"
    },
    ...
  ]
}
```

### Deploy Site
**POST** `/api/deploy`
**Request**: Multipart Form (`site_name`, `file`)
**Response (Success)**
```json
{
  "success": true,
  "site": "mysite",
  "file_count": 10,
  "size_bytes": 1024,
  "message": "Deployment successful"
}
```
**Response (Error)**
```json
{
  "success": false,
  "error": "Invalid ZIP file..."
}
```

### Site Logs
**GET** `/api/logs?site_id={id}`
**Response (200 OK)**
```json
{
  "success": true,
  "logs": null
}
```
*Note: Uses `logs` key.*

### Deployment History
**GET** `/api/deployments`
**Response (200 OK)**
```json
{
  "success": true,
  "deployments": null
}
```
*Note: Uses `deployments` key.*

### Environment Variables
**GET** `/api/envvars?site_id={id}`
**Response (200 OK)**
```json
{
  "success": true,
  "vars": [
    { "id": 1, "name": "TEST_VAR" }
  ]
}
```
*Note: Uses `vars` key.*

**POST** `/api/envvars`
**Response (200 OK)**
```json
{
  "success": true
}
```
