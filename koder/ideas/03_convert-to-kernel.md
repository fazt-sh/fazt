# Vision Document: Fazt v0.8 - The AI-Ready Personal Cloud OS

**Status**: Draft / Request for Comment (RFC)
**Target**: v0.8 Architecture
**Scope**: High-Level Strategic Pivot

---

## 1. Executive Summary: The Paradigm Shift

- the following is an analysis by Gemini 3.0 about a few ideas i discussed in
  ../ideas/01_random.md
- i found an interesting paradigm: apps! Everything could be an app
- for instance: dashboard is an app
- any capabiliy: tunnel, webhooks, events, etc are all apps

### Whats an app

App is simply a folder with the following structure:

```
my_marketplace/
  marketplace.json
  registry.json
  logo.svg // 512 * 512
  apps/
    01_app/
      app.json
      logo.svg // 512 * 512
      index.html
      styles.css
      script.js
      api/
        main.js
        db.js
        my_helper.js
```

- Most of those files are optional
- whats shown above is the full scale of what it is
- The recommended way to add a marketplace is via git repo
- an app can be added without a market place, in that case it goes in "Personal
  Marketplace" for clarification (sideloading)

#### The new api/ folder

- we are moving the main.js and associated files into an api folder to prevent
  collisions and improve organisation
- we will add a require() shim to goja runtime

## Shift it thinking

- some features can be accessed via binary's commands
- *all* features can be accessed via API
- *all* features will be accessible via dashboard UI as API for Everything
  exists

### AI capabilities

- we are thinking to make fazt an mcp server
- so that we can connect it to claude code for server management
- we are also building a simple ai() function to connect to
  Gemini/Anthropic/OpenAI/Ollama natively from the serverless function
- this with event triggers may help us run simple agentic work with fazt

## Questions

- is it better to completely rebuild this project?
- significant work has been implemented in this so far
- isn't it crazy? But I think if this new paradigm of os makes sense, I think we
  have something here?

### If rebuilding

- i think we should start with API design
- then build the entire dashboard with mock data via that API
- then for that spec, build a test suite in go
- finally build the binary against that test suite

Stop me if this is crazy.

Following is a report generated by Gemini trying to wrap up my conversation with
it
----

**From**: "A simple static site host for a $6 VPS."
**To**: "A single-binary Operating System for Personal Apps and AI Agents."

Original Fazt (v0.1-0.7) solved **Deployment**. It made getting a website online
as easy as dragging a file.

Fazt v0.8 solves **Compute & Persistence**. It acknowledges that in 2025, users
don't just want to "host HTML"; they want a permanent home for their digital
lives and a backend for their AI agents.

We are moving away from the "Web Server" metaphor (Apache/Nginx) to the
"Kernel" metaphor. The Fazt Binary is the Kernel; the Dashboard is the Shell;
User Deployments are Processes.

---

## 2. Core Architectural Pillars

### A. The "Unsinkable" Kernel (Stability First)
We operate on constrained hardware (1GB RAM). Most platforms crash under load.
Fazt v0.8 prioritizes **Survival** over **Service**.

* **The Cockpit Rule**: The Admin Dashboard and Authentication must exist in
    "Pinned RAM" (hydrated at boot). They are served directly from memory,
    bypassing the FileSystem/Database entirely.
* **Circuit Breakers**:
    * **RAM**: Byte-limited LRU. Large files (>5MB) never touch RAM; they are
        streamed via zero-copy I/O.
    * **Disk**: `PRAGMA auto_vacuum = INCREMENTAL`. Writes are rejected if
        usage > 80%, preserving the DB from corruption.
    * **Network**: User sites are throttled if they exceed monthly egress,
        protecting the owner's wallet.

### B. Identity Layer: "Everything is an App"
We abandon the concept of "Sites" tied to domains. We adopt "Apps" tied to
UUIDs.

* **Stable Identity**: `app-xyz123` is the persistent container.
* **Decoupled Routing**: `blog.fazt.sh`, `custom-domain.com`, and private
    email routers (`inbox-xyz@fazt.sh`) are just pointers to the App UUID.
* **Benefit**: An app can change its name, domain, or owner without losing
    its database rows or logs.

### C. The Agentic Runtime (Serverless v2)
We transform the JavaScript engine from a "templating tool" into a robust
application runtime compatible with AI workflows.

* **Standard Library**: We embed `lodash`, `cheerio`, `uuid`, and `zod`
    (ES5 builds) into the binary. Agents can `require('lodash')` without
    installing anything.
* **MCP Native**: Fazt exposes itself as a Model Context Protocol server.
    Agents can deploy apps, read logs, and query databases directly.
* **Headless Apps**: `api/main.js` is a valid app. No HTML required. This
    is the perfect "Micro-Tool" format for AI (e.g., a Price Checker).

### D. Distribution: The "Linux" Model
We reject the centralized "App Store" server model.

* **Repositories**: A Marketplace is just a Git URL.
* **Package Manager**: `fazt app install` works like `apt-get`. It fetches
    code from a remote repo and hydrates it into the local VFS.
* **Personal Marketplace**: Every deployment not from a repo is treated as
    "Sideloaded" (Personal Source).

---

## 3. Usage Expansion Analysis

**How does this change the utility?**

1.  **For the Developer (The "Surge.sh" replacement)**:
    They still get instant static hosting. But now, they get a free backend.
    They can add a `db.js` to their static site and have persistence without
    spinning up Supabase or Firebase.

2.  **For the AI Agent (The "Tool Store")**:
    Currently, Agents are ephemeral. They have no memory.
    With Fazt, an Agent can write a script, deploy it to your VPS, and use it
    to store long-term memory or run cron jobs. Fazt becomes the "Body" for
    the AI "Brain".

3.  **For the Power User (The "Personal Cloud")**:
    They can host a 20GB Media Library alongside a lightweight Blog. The
    "Unsinkable" architecture ensures the Blog stays fast even while the
    Media Library thrashes the disk.

---

## 4. Critical Analysis: The Risks & Cons

We must be honest about the dangers of this direction.

### A. Is this Feature Creep?
**Verdict: YES, High Risk.**
We are dangerously close to reinventing an Operating System. Implementing
`require()`, stdlibs, and email sinks drastically increases the surface area.
* *Mitigation*: Strict adherence to "Single Binary". If a feature requires
    an external process (e.g., ffmpeg, nodejs), we reject it.

### B. Is it feasible on a $6 Machine?
**Verdict: YES, but with caveats.**
* *The Good*: Go and SQLite are efficient. The "Safeguards" (Phase 10) are
    specifically designed for this.
* *The Bad*: Running 50 concurrent JS VMs (Goja) is heavier than Nginx
    serving static files. We are trading *Throughput* for *Capability*. Users
    must understand this is not a high-performance web server; it is an app
    server.

### C. The "Standard Library" Trap
**Verdict: Maintenance Burden.**
By embedding `lodash` and `cheerio`, we become responsible for updating them.
If `cheerio` has a vulnerability, we must release a new binary.
* *Mitigation*: Keep the list tiny (Top 10 only).

---

## 5. Market Gap Analysis

 | System         | Focus        | Pros                   | Cons                           |
 | :---           | :---         | :---                   | :---                           |
 | **Vercel**     | FE Devs      | Excellent DX, Edge.    | Vendor lock-in, expensive DB.  |
 | **Coolify**    | SysAdmins    | Powerful (Docker).     | Heavy (needs 2GB+ RAM).        |
 | **PocketBase** | Backend      | Great DB + UI.         | No frontend hosting/routing.   |
 | **Sandstorm**  | Privacy      | Secure apps.           | Dead ecosystem, hard to build. |
 | **Fazt v0.8**  | **AI/Indie** | **Zero-Dep, Low RAM.** | **Lower raw performance.**     |

**The Fazt Niche:**
There is NO tool today that lets you deploy a full-stack app (Frontend +
Backend + DB) to a fresh Ubuntu server by copying **one binary**. Coolify requires
Docker. Vercel requires Cloud. PocketBase requires a separate frontend host.

Fazt v0.8 captures the **"Indie Hacker on a Budget"** and the **"AI Agent
Owner"** who needs a sandbox.

---

## 6. Verdict: Go or No Go?

**Recommendation: GO.**

The pivot from "Static Host" to "Personal OS" is necessary. The static hosting
market is commoditized (GitHub Pages, Cloudflare Pages).

The **"Personal Cloud with an AI Interface"** market is completely empty.

If we execute the **Safeguards** (Plan 10) first, we earn the right to build
the **Features** (Runtime, Marketplace). Without the safeguards, the features
will just crash the server.

**Evolution Plan:**
1.  **Stabilize**: Build the Cockpit (Plan 10).
2.  **Identify**: Build the UUID/App Layer (Plan 33).
3.  **Empower**: Build the Runtime/StdLib (Plan 30).
4.  **Distribute**: Build the Marketplace (Plan 34).
